!function(){"use strict";var Timesheet=function(container,beg,end,scheduledData,requestData,bubbleClickCallBack){this.scheduledData=[],this.requestData=[],this.beg=beg,this.end=end,this.widthDay=0,this.bubbleClickCallBack=bubbleClickCallBack,this.parse(scheduledData||[],requestData||[]),"undefined"!=typeof document&&(this.container="string"==typeof container?document.querySelector("#"+container):container,this.leftOffset=this.container.innerWidth,this.drawSections(),this.insertData(),this.initFunctions())};Timesheet.prototype.getScheduledData=function(){for(var newScheduleData=[],lis=document.getElementsByClassName("schedule-li"),n=0,m=lis.length;n<m&&!lis[n].className.includes("non-data");n++)newScheduleData.push(lis[n].value);return newScheduleData},Timesheet.prototype.scheduledDataHasIntersection=function(){for(var scheduleDataTime=[],lis=document.getElementsByClassName("schedule-li"),n=0,m=lis.length;n<m&&!lis[n].className.includes("non-data");n++){var allData=this.scheduledData.concat(this.requestData);for(var i in allData)allData[i].data==lis[n].value&&scheduleDataTime.push({beg:allData[i].beg,end:allData[i].end})}scheduleDataTime.sort(function(a,b){return a=a.beg,b=b.beg,a<b?-1:a>b?1:0});for(var i=0,j=scheduleDataTime.length-1;i<j;i++)if(scheduleDataTime[i].end>scheduleDataTime[j].beg)return!0;return!1},Timesheet.prototype.initFunctions=function(){var popup='<div class="popup" id="popup"><div class="popupContent"><h4></h4><div id="imgs"></div><button class="backButton" id="backButton">Back</button></div></div>';this.container.innerHTML+=popup,popup=document.getElementById("popup"),popup.style.display="none";var timeSheet=this,slider=document.querySelector("#timeRange");timeSheet.onSliderChange(slider),document.querySelector("#timeRange").addEventListener("change",function(){timeSheet.onSliderChange(this)}),document.querySelector("#timeLabel").addEventListener("click",function(){var timeStamp=timeSheet.getSliderTime(slider),indexList=timeSheet.getIndexListFromTimestamp(timeStamp);timeSheet.onTimeLabelClicked(indexList,timeStamp)}),document.querySelector("#backButton").addEventListener("click",function(){timeSheet.togglePopup()});for(var lis=document.getElementsByClassName("schedule-li"),n=0,m=lis.length;n<m;n++)lis[n].className.includes("separator")||lis[n].addEventListener("click",function(){timeSheet.bubbleClickCallBack&&timeSheet.bubbleClickCallBack(this.value)})},Timesheet.prototype.onTimeLabelClicked=function(indexList,timeStamp){document.querySelector("#imgs").innerHTML="";for(var n=0,m=indexList.length;n<m;n++){var imgSrc=this.scheduledData[indexList[n]].img,img=document.createElement("input");img.setAttribute("class","popupImage"),img.setAttribute("type","image"),img.setAttribute("src",imgSrc),document.querySelector("#imgs").appendChild(img)}var date=new Date(1e3*timeStamp);document.querySelector("h4").innerHTML=date.toTimeString(),this.togglePopup()},Timesheet.prototype.insertData=function(){function _insert_data(parent,data,colors){for(var n=0,m=data.length;n<m;n++){var cur=data[n],bubble=parent.createBubble(parent.widthDay,parent.beg,parent.end,cur.beg,cur.end),icon='<div class="img-container"><img class="icon" src="'+cur.img+'"><span style="margin-left: 0px; position: absolute; color: rgba(240, 200, 70, 1); background-color: rgba(30, 80, 180, 1);">'+cur.label+"</span></div>",scheduledLine=['<span style="margin-left: '+(bubble.getStartOffset()+100)+"px; width: "+bubble.getWidth()+'px;" class="bubble bubble-'+colors[n%colors.length]+'"></span>'].join("");html.push('<li class="schedule-li" value="'+cur.data+'">'+icon+scheduledLine+"</li>")}}var html=[];this.widthDay=this.container.querySelector(".scale section").offsetWidth;var scheduledColors=["default","green","blue","yellow","cyan"],requestColors=["grey"];_insert_data(this,this.scheduledData,scheduledColors),html.push('<li class="non-data schedule-li"><div class="separator"><span>Pending Requests</span></div></li>'),_insert_data(this,this.requestData,requestColors),this.container.innerHTML+='<ul class="data">'+html.join("")+"</ul>"},Timesheet.prototype.drawSections=function(){var html=[],monthNames=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],currentDate=new Date(1e3*this.beg);currentDate.setHours(0),currentDate.setMinutes(0),currentDate.setSeconds(0);var endDate=new Date(1e3*this.end);for(endDate.setHours(0),endDate.setMinutes(0),endDate.setSeconds(0);currentDate.getTime()<endDate.getTime();){var secName=monthNames[currentDate.getMonth()]+"/"+currentDate.getDate();html.push("<section>"+secName+"</section>"),currentDate.setDate(currentDate.getDate()+1)}this.container.className="timesheet color-scheme-default",this.container.innerHTML='<div class="scale"><div class="timeLabel"><span class="timeLabelText" id="timeLabel"></span></div><div class="slidecontainer"><input type="range" min="1" max="720" value="1" class="slider" id="timeRange"></div>'+html.join("")+'<div class="vl"></div></div>'},Timesheet.prototype.parse=function(scheduledData,requestData){var beg,end,appId,img,label,data,n,m;for(n=0,m=scheduledData.length;n<m;n++)beg=scheduledData[n][0],end=scheduledData[n][1],appId=scheduledData[n][2],img=scheduledData[n][3],label=scheduledData[n][4],data=scheduledData[n][5],beg<this.end&&end>this.beg&&this.scheduledData.push({beg:beg,end:end,appId:appId,img:img,label:label,data:data});for(n=0,m=requestData.length;n<m;n++)beg=requestData[n][0],end=requestData[n][1],appId=requestData[n][2],img=requestData[n][3],label=requestData[n][4],data=requestData[n][5],beg<this.end&&end>this.beg&&this.requestData.push({beg:beg,end:end,appId:appId,img:img,label:label,data:data})},Timesheet.prototype.createBubble=function(widthDay,min,max,start,end){return new Bubble(widthDay,min,max,start,end)},Timesheet.prototype.togglePopup=function(){var popup=document.getElementById("popup");"none"===popup.style.display?popup.style.display="block":popup.style.display="none"},Timesheet.prototype.getIndexListFromTimestamp=function(timestamp){for(var indexList=[],n=0,m=this.scheduledData.length;n<m;n++)this.scheduledData[n].beg<=timestamp&&this.scheduledData[n].end>=timestamp&&indexList.push(n);return indexList},Timesheet.prototype.createBubble=function(widthDay,min,max,start,end){return new Bubble(widthDay,min,max,start,end)},Timesheet.prototype.getSliderTime=function(slider){return this.beg+slider.value/slider.max*(this.end-this.beg)},Timesheet.prototype.onSliderChange=function(slider){var vertLine=document.querySelector(".vl"),timeLabel=document.querySelector("#timeLabel"),offset=this.getStartOffset(this.getSliderTime(slider))-1+"px";vertLine.style.height=this.container.offsetHeight-68+"px",vertLine.style.left=offset,timeLabel.style.left=offset;var time=new Date(1e3*this.getSliderTime(slider));timeLabel.textContent=time.toTimeString()},Timesheet.prototype.getStartOffset=function(timestamp){return timestamp<this.beg?0:this.widthDay/24*(timestamp/60/60-this.beg/60/60)};var Bubble=function(widthDay,min,max,beg,end){this.min=min,this.max=max,this.beg=beg,this.end=end,this.widthDay=widthDay};Bubble.prototype.formatHour=function(num){return num=parseInt(num,10),num>=10?num:"0"+num},Bubble.prototype.getStartOffset=function(){return this.beg<this.min?0:this.widthDay/24*(this.beg/60/60-this.min/60/60)},Bubble.prototype.getHours=function(){var beg=this.beg,end=this.end;return this.beg<this.min&&(beg=this.min),this.end>this.max&&(end=this.max),end/60/60-beg/60/60},Bubble.prototype.getWidth=function(){return this.widthDay/24*this.getHours()},window.Timesheet=Timesheet}();